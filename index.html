<!DOCTYPE html>
<!-- This is a very simple example of using Web WorldWind. -->
<html>
  <head lang="en">
    <meta charset="UTF-8" />
    <title>WorldWind Example</title>
    <!-- Include the Web WorldWind library. -->
    <script
      src="https://files.worldwind.arc.nasa.gov/artifactory/web/0.9.0/worldwind.min.js"
      type="text/javascript"
    ></script>
  </head>
  <body>
    <div style="position: absolute; top: 50px; left: 50px">
      <style>
        body {
          background-image: url("./space.jpeg");
          background-repeat: no-repeat, repeat;
          background-color: #000;
        }
      </style>
      <!-- Create a canvas for Web WorldWind. -->
      <canvas id="canvasOne" width="1024" height="768">
        Your browser does not support HTML5 Canvas.
      </canvas>
    </div>
    <script>
      // Register an event listener to be called when the page is loaded.
      window.addEventListener("load", eventWindowLoaded, false);
      // Define the event listener to initialize Web WorldWind.
      function eventWindowLoaded() {
        // Create a WorldWindow for the canvas.
        var wwd = new WorldWind.WorldWindow("canvasOne");

        // Add some image layers to the WorldWindow's globe.
        wwd.addLayer(new WorldWind.BMNGOneImageLayer());
        wwd.addLayer(new WorldWind.BMNGLandsatLayer());
        wwd.addLayer(new WorldWind.AtmosphereLayer());
        // Add a compass, a coordinates display and some view controls to the WorldWindow.
        wwd.addLayer(new WorldWind.CompassLayer());
        wwd.addLayer(new WorldWind.CoordinatesDisplayLayer(wwd));
        wwd.addLayer(new WorldWind.ViewControlsLayer(wwd));

        //add model
        // Create renderable layer to hold the Collada model.
        var modelLayer = new WorldWind.RenderableLayer("Model");
        wwd.addLayer(modelLayer);

        var modelScene, colladaLoader;

        function init() {
          var data = fetchAsync().then(function (result) {
            console.log(result);
            console.log(result["iss_position"]);
            lat = result["iss_position"]["latitude"];
            lon = result["iss_position"]["longitude"];
            var position = new WorldWind.Position(lat, lon, 1000e3);
            // Create a Collada loader and direct it to the desired directory and .dae file.
            colladaLoader = new WorldWind.ColladaLoader(position);
            colladaLoader.init({ dirPath: "./model/" });
            duckScene = null;
            colladaLoader.load("", function (scene) {
              scene.scale = 20000;
              modelLayer.addRenderable(scene); // Add the Collada model to the renderable layer within a callback.
              modelScene = scene;
            });

            wwd.navigator.lookAtLocation.latitude = lat;
            wwd.navigator.lookAtLocation.longitude = lon;
          });
        }

        var lat, lon;
        async function fetchAsync() {
          let response = await fetch("http://api.open-notify.org/iss-now.json");
          let data = await response.json();
          return data;
        }

        function move() {
          var data = fetchAsync().then(function (result) {
            lat = result["iss_position"]["latitude"];
            lon = result["iss_position"]["longitude"];
            var position = new WorldWind.Position(lat, lon, 1000e3);

            modelScene.position = position;
            wwd.redraw();
          });
        }

        init();
        // Define a position for locating the model

        var intervalId = window.setInterval(function () {
          move();
        }, 3000);
      }
    </script>
  </body>
</html>
